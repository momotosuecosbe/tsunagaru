There are different ways to generate and store a password using an email in FastAPI and mySQL, but one possible approach is to use the following steps:

-   [Create a User model with fields for email, hashed_password, is_active, is_superuser, and confirmation](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email)[1](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email).
-   [Create a User schema with fields for username, email, password, and is_active](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email)[1](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email).
-   [Create a Users class that handles the database operations for saving and checking users](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email)[1](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email).
-   [Create an Auth class that handles the generation and verification of JWT tokens](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email)[1](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email).
-   [Create a Mailer class that handles the sending of confirmation emails to users](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email)[1](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email).
-   [Create an API route that accepts a UserCreate schema as form data and checks if the user already exists in the database](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email)[1](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email).
-   [If the user does not exist, create a User instance with the email, hashed password (using Hasher.get_password_hash), is_active (set to False), is_superuser (set to False), and confirmation (set to a UUID)](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email)[1](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email).
-   [Generate a confirmation token using Auth.get_confirmation_token and set the user’s confirmation field to the token’s jti](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email)[1](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email).
-   [Try to send a confirmation email to the user using Mailer.send_confirmation_message with the token and the email](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email)[1](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email).
-   [If the email is sent successfully, save the user to the database using Users.save_user and return the user as a ShowUser schema](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email)[1](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email).
-   If the email fails to send, raise an HTTPException with status code 500 and detail "Email couldn’t be send. [Please try again."](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email)[1](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email)

[You can find an example of this approach in](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email) [1](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email), but note that it uses PostgreSQL instead of mySQL. You may need to modify some parts of the code to work with mySQL, such as using a different database URL and driver. [You can also find some other examples of FastAPI projects that use mySQL in](https://blog.logrocket.com/server-side-rendering-with-fastapi-and-mysql/) [2](https://blog.logrocket.com/server-side-rendering-with-fastapi-and-mysql/) and [3](https://github.com/vuongtlt13/full-stack-fastapi-mysql)[, but they may not have the same features as](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email) [1](https://stackoverflow.com/questions/68362154/fastapi-user-authentication-with-verification-email).


To verify the user’s email after they click on the confirmation link, you need to do the following steps:

-   [Create another API route that accepts a GET request with a verification code as a URL parameter](https://codevoweb.com/api-with-python-fastapi-signup-user-and-verify-email/)[1](https://codevoweb.com/api-with-python-fastapi-signup-user-and-verify-email/).
-   [Use Auth.verify_confirmation_token to decode the verification code and get the user’s id](https://bing.com/search?q=verify+user+email+with+confirmation+link+in+FastAPI)[2](https://bing.com/search?q=verify+user+email+with+confirmation+link+in+FastAPI).
-   Use Users.get_user_by_id to retrieve the user from the database using the id[2](https://bing.com/search?q=verify+user+email+with+confirmation+link+in+FastAPI).
-   [If the user is found and the confirmation field matches the verification code, set the user’s is_active field to True and save the user to the database](https://bing.com/search?q=verify+user+email+with+confirmation+link+in+FastAPI)[2](https://bing.com/search?q=verify+user+email+with+confirmation+link+in+FastAPI).
-   [Return a success message to the user, such as "Your account has been activated."](https://bing.com/search?q=verify+user+email+with+confirmation+link+in+FastAPI)[2](https://bing.com/search?q=verify+user+email+with+confirmation+link+in+FastAPI)
-   [If the user is not found or the confirmation field does not match the verification code, return an error message to the user, such as "Invalid or expired token."](https://bing.com/search?q=verify+user+email+with+confirmation+link+in+FastAPI)[2](https://bing.com/search?q=verify+user+email+with+confirmation+link+in+FastAPI)

[You can find an example of this approach in](https://bing.com/search?q=verify+user+email+with+confirmation+link+in+FastAPI) [2](https://bing.com/search?q=verify+user+email+with+confirmation+link+in+FastAPI), but note that it uses PostgreSQL instead of mySQL. You may need to modify some parts of the code to work with mySQL, such as using a different database URL and driver. [You can also find some other examples of FastAPI projects that use email verification in](https://www.twilio.com/blog/email-address-verification-fastapi-twilio-verify) [3](https://www.twilio.com/blog/email-address-verification-fastapi-twilio-verify) and [1](https://codevoweb.com/api-with-python-fastapi-signup-user-and-verify-email/)[, but they may not have the same features as](https://bing.com/search?q=verify+user+email+with+confirmation+link+in+FastAPI) [2](https://bing.com/search?q=verify+user+email+with+confirmation+link+in+FastAPI).

To handle expired tokens in FastAPI, you need to do the following steps:

-   [Check if the token is expired while validating it in your dependency function, such as get_current_user](https://stackoverflow.com/questions/68811220/handling-the-token-expiration-in-fastapi)[1](https://stackoverflow.com/questions/68811220/handling-the-token-expiration-in-fastapi).
-   [If the token is expired, raise an HTTPException with status code 401 and detail "Token has expired"](https://stackoverflow.com/questions/68811220/handling-the-token-expiration-in-fastapi)[1](https://stackoverflow.com/questions/68811220/handling-the-token-expiration-in-fastapi).
-   [Create another API route that accepts a refresh token as a URL parameter or a header](https://stackoverflow.com/questions/62413698/how-to-use-refresh-token-with-fastapi)[2](https://stackoverflow.com/questions/62413698/how-to-use-refresh-token-with-fastapi).
-   [Use Auth.verify_refresh_token to decode the refresh token and get the user’s id](https://stackoverflow.com/questions/62413698/how-to-use-refresh-token-with-fastapi)[2](https://stackoverflow.com/questions/62413698/how-to-use-refresh-token-with-fastapi).
-   [Use Users.get_user_by_id to retrieve the user from the database using the id](https://stackoverflow.com/questions/62413698/how-to-use-refresh-token-with-fastapi)[2](https://stackoverflow.com/questions/62413698/how-to-use-refresh-token-with-fastapi).
-   [If the user is found and the refresh token is valid, create a new access token using Auth.create_access_token and return it to the user](https://stackoverflow.com/questions/62413698/how-to-use-refresh-token-with-fastapi)[2](https://stackoverflow.com/questions/62413698/how-to-use-refresh-token-with-fastapi).
-   [If the user is not found or the refresh token is invalid, raise an HTTPException with status code 401 and detail "Invalid or expired token"](https://stackoverflow.com/questions/62413698/how-to-use-refresh-token-with-fastapi)[2](https://stackoverflow.com/questions/62413698/how-to-use-refresh-token-with-fastapi).

You can find an example of this approach in [2](https://stackoverflow.com/questions/62413698/how-to-use-refresh-token-with-fastapi), but note that it uses PostgreSQL instead of mySQL. You may need to modify some parts of the code to work with mySQL, such as using a different database URL and driver. [You can also find some other examples of FastAPI projects that handle expired tokens in](https://fastapi.tiangolo.com/tutorial/security/oauth2-jwt/) [3](https://fastapi.tiangolo.com/tutorial/security/oauth2-jwt/), [4](https://dev.to/deta/deta-fastapi-jwt-auth-part-1-4c82), and [5](https://indominusbyte.github.io/fastapi-jwt-auth/advanced-usage/dynamic-expires/)[, but they may not have the same features as](https://stackoverflow.com/questions/62413698/how-to-use-refresh-token-with-fastapi) [2](https://stackoverflow.com/questions/62413698/how-to-use-refresh-token-with-fastapi).

I hope this helps you understand how to handle expired tokens in FastAPI.